{% comment %}

Карточка материала для главной страницы

    inputs:
        material - событие
        material_url - url адрес материала
        material_image - изображение
        is_orange - оранжевая рамка
        is_big_image - большая фотография и увеличенный размер карточки (используется в сюжетах)
        is_video - материал типа видео
        is_expert - материала типа эксперт
        is_lazyload - ленивая загрузка изображений
        label_text - текст метки
        label_class - класс метки
        metrika_goal - цель для Яндекс.Метрики
        audit_goal - цель для внутренней админки
        request - запрос

    Также можно передвать и другие параметры через вызов {% material_card material param=value %}
{% endcomment %}

{% load staticfiles news_tags str_utils comments_tags thumbnail date_tags utils_tags pytils_numeral cache_tags %}

{% cache 3600 'news.tags.material_card_light' vary='material.pk,material.is_hidden,metrika_goal,audit_goal,request.user_agent.is_gadget,is_big_image,is_orange,is_photorep,is_lazyload' tags='material' %}
    <article class="b-widget-material
        {% if material.is_hidden %}g-hidden-material{% endif %}
        {% if is_orange %}orange{% endif %}
        {% if is_big_image %}type2{% endif %}
        {% if is_photorep %}b-widget-material_photorep{% endif %}"
    >
        <header class="b-widget-material-header">
            <a href="{{ material_url }}" class="b-widget-material-header-link {% if metrika_goal %}j-metrika-goal{% endif %} {% if audit_goal %}j-audit-goal-click{% endif %}
                    {% if 'impression' in track %}j-analytics-impression{% endif %}
                    {% if 'click' in track %}j-analytics-click{% endif %}"
               {% if metrika_goal %}
                   data-metrika-goal="{{ metrika_goal }}"
               {% endif %}
               {% if audit_goal %}
                   data-audit-goal="{{ audit_goal }}"
                   data-audit-material="{{ audit_material }}"
               {% endif %}
               {% if analytics_cat %}
                   data-analytics-category="{{ analytics_cat }}"
                   data-analytics-label="{{ material.title|escape }}"
               {% endif %}
               {% if target %}target="{{ target }}"{% endif %}
            >

                {% if material_image %}
                    <figure class="b-widget-material-figure{% if is_video %} icon-block icon-video{% elif is_expert %} icon-block{% endif %}">
                        {% if request.user_agent.is_gadget %}
                            {% thumbnail material_image image_size_gadget as thumb %}
                            <img alt="{{ material.title|typograf }}" width="100%" height="auto"
                                {% if is_lazyload %}
                                    class="b-widget-material-image j-lazy-load" data-original="{{ thumb }}" src="{% static 'img/gag_340x160.png' %}"
                                {% else %}
                                    class="b-widget-material-image" src="{{ thumb }}"
                                {% endif %}
                            >
                        {% else %}
                            {% if is_wide %}
                                {% thumbnail material_image 300x132 crop as thumb %}
                                <img alt="{{ material.title|typograf }}" width="{{ thumb.width }}" height="{{ thumb.height }}"
                                    {% if is_lazyload %}
                                        class="b-widget-material-image j-lazy-load" data-original="{{ thumb }}"
                                    {% else %}
                                        class="b-widget-material-image" src="{{ thumb }}"
                                    {% endif %}
                                >
                            {% else %}
                                {% thumbnail material_image image_size as thumb %}
                                <img alt="{{ material.title|typograf }}" width="{{ thumb.width }}" height="{{ thumb.height }}"
                                    {% if is_lazyload %}
                                        class="b-widget-material-image j-lazy-load" data-original="{{ thumb }}"
                                    {% else %}
                                        class="b-widget-material-image" src="{{ thumb }}"
                                    {% endif %}
                                >
                            {% endif %}
                        {% endif %}

                        {% if label_text %}
                            <span class="b-widget-material-label">{{ label_text }}</span>
                        {% endif %}
                    </figure>
                {% endif %}

                <h4 class="b-widget-material-title">{{ material|typograf }}</h4>
            </a>
        </header>

        {% if material.caption and material.title|length < 63 %}
            <p class="b-widget-material-caption">{{ material.caption|typograf|truncatechars:'70' }}</p>
        {% endif %}


        <a href="{{ material_url }}" class="b-widget-material-link
            {% if metrika_goal %}j-metrika-goal{% endif %}
            {% if audit_goal %}j-audit-goal-click{% endif %}
            {% if 'impression' in track %}j-analytics-impression{% endif %}
            {% if 'click' in track %}j-analytics-click{% endif %}
            "
            {% if metrika_goal %}
                data-metrika-goal="{{ metrika_goal }}"
            {% endif %}
            {% if audit_goal %}
                data-audit-goal="{{ audit_goal }}"
                data-audit-material="{{ audit_material }}"
            {% endif %}
            {% if analytics_cat %}
                data-analytics-category="{{ analytics_cat }}"
                data-analytics-label="{{ material.title|escape }}"
            {% endif %}
        ></a>
        {% if metrika_goal %}
            <span class="j-metrika-goal" data-metrika-goal="{{ metrika_goal }}">
                {% comments_cnt material new_layout=True new_card="light" url=material_url %}
            </span>
        {% else %}
            {% comments_cnt material new_layout=True new_card="light" url=url %}
        {% endif %}

        {% if is_expert %}
            <a href="{{ material_url }}#questions" class="b-widget-material__comments">
                {{ material.questions_count }}&nbsp;{{ material.questions_count|choose_plural:'вопрос,вопроса,вопросов' }}
            </a>
        {% endif %}
    </article>
{% endcache %}
