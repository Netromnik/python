{% extends 'admin/change_form.html' %}
{% load i18n admin_modify %}

{% block content %}
<div id="content-main">

{% block object-tools %}{{ block.super }}{% endblock %}{# Not copying block content #}

<form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.module_name }}_form">{% csrf_token %}{% block form_top %}{% endblock %}
<table width="100%">
<tr>
<td width="70%" valign="top">
<div>
{% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}
{% if save_on_top %}{% submit_row %}{% endif %}
{% if errors %}
    <p class="errornote">
    {% blocktrans count errors|length as counter %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
    </p>
    <ul class="errorlist">{% for error in adminform.form.non_field_errors %}<li>{{ error }}</li>{% endfor %}</ul>
{% endif %}

{% for fieldset in adminform %}
  {% include "admin/includes/fieldset.html" %}
{% endfor %}

{% block after_field_sets %}{% endblock %}
{% block after_related_objects %}{% endblock %}

{% submit_row %}

{% if adminform and add %}
   <script type="text/javascript">document.getElementById("{{ adminform.first_field.auto_id }}").focus();</script>
{% endif %}

{# JavaScript for prepopulated fields #}
{% prepopulated_fields_js %}

</div>
</td>
<td width="30%" valign="top">
<div>
{% for inline_admin_formset in inline_admin_formsets %}
    {% include inline_admin_formset.opts.template %}
{% endfor %}
</div>
</td>
</tr>
</table>
</form></div>
<style>
	.imageForText{
		position:absolute;
	}
	.errPosition{
		border:2px solid red;
	}
	.goodPosition{
		border:2px solid green;
	}
	.block{
		width:60px;
		height:60px;
	}
	.block2{
		width:60px;
		height:40px;
	}
</style>
<script type="text/javascript">
	var started = false;
	$((function() {
		$(".imageForText").draggable({
			revert:true,
			start: function(event, ui) {
				img = ui;
				$(ui.helper).addClass('errPosition');
				if(!started){
					started = true;
					$(".mceEditor").droppable({
					      drop: function(event, ui) {
					      		if ( ui.helper[0].className.indexOf("File")>0 ) {
					      			url = $(ui.helper).attr('file');
					      			$('textarea:tinymce').tinymce().execCommand('mceInsertContent',true,'<a href="'+url+'">' + ui.helper[0].title + '</a>')
					      		}else{
									imgUrl = $(ui.helper).attr('bigImage');
									$('textarea:tinymce').tinymce().execCommand('mceInsertContent',true,'<img src="'+imgUrl+'"/>')
					      		}
					      },
					      over: function(event, ui) {
					    	  $(ui.helper).removeClass('errPosition');
					    	  $(img.helper).addClass('goodPosition');
					      },
					      out: function(event, ui) {
					    	  $(ui.helper).removeClass('goodPosition');
					    	  $(img.helper).addClass('errPosition');
					      }

					 });
				}
			},
			drag: function(event, ui) {
				//console.log(event)
			},
			stop: function(event, ui) {
				$(ui.helper).removeClass('errPosition');
				$(ui.helper).removeClass('goodPosition');
			}
		});
	});
</script>
{% endblock %}