{% extends "admin/change_list.html" %}
{% load i18n staticfiles media_utils %}
{% block extrahead %}
    {{ block.super }}
    {% if request.path == '/adm/recycle/category/' %} 
        <meta charset="utf-8">
        <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
        <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700&display=swap" rel="stylesheet">
        {% less '/less/compile/apps/recycle.less' %}
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        
        <script>
            $(function(){
                if (window.location.pathname == '/adm/recycle/category/')
                {
                    var CATEGORIES_URL = '{% url 'recycle:admin_categories' %}';
                    var SAVE_ORDER_URL = '{% url 'recycle:admin_save_order' %}';

                    $.get(CATEGORIES_URL).done(function(cats){
                        $('#content-main').append('<h2>Порядок отображения категорий</h2>');
                        $('#content-main').append(
                            '<div class="catblock" style = "width: 20%;">' +
                                '<div class="catlist" id="slist_garbage">' +  
                                '</div>' + 
                            '</div>'
                        );
                        for (var i = 0; i < cats.length; i++)
                        {
                            $('.catlist').append(
                                '<div id="' + cats[i].id + '" class="catlist__item catlist__item_' + cats[i].icon_class +'">' + 
                                    '<div class="catlist__name">' + cats[i].name + '</div>' +
                                '</div>'
                            );
                        }
                        $('.catlist').sortable({
                            connectWith: "div"
                        });
                        $('.catlist').disableSelection();
                        $('.catblock').append('<input type="button" id="save_order" value="Сохранить порядок" name="_anotherbutton" style="margin: 10px 0px 0px 0px; padding: 5px 10px 5px 10px;"/>');
                        $('#save_order').click(function() {
                            var new_order = [];
                            for (var i = 0; i < cats.length; i++)
                            {
                                var id = $('.catlist').children()[i].id;
                                new_order.push(
                                {
                                    id: id,
                                    order: i
                                });
                            }
                            new_order = JSON.stringify(new_order);
                            $.get(SAVE_ORDER_URL, {'new_order': new_order}).then(function(){
                                alert('Изменения сохранены');
                            });
                            
                        });
                        
                    }); 
                }
            });
        </script>


    {% endif %}
{% endblock %}

{% block footer %}
    {% if request.path == '/adm/recycle/category/' %} 
        <script>
            var less = {
                javascriptEnabled: true
            };
        </script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/3.9.0/less.min.js" ></script>
    {% endif %}
{% endblock %}

